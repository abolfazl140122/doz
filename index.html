<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تست اتصال به سرور Appwrite</title>
    <style>
        /* --- استایل‌های کلی و فونت --- */
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');

        :root {
            --primary-color: #f02e65; /* رنگ اصلی اپ‌رایت */
            --success-color: #10b981;
            --error-color: #ef4444;
            --neutral-color: #6b7280;
            --light-bg: #f9fafb;
            --dark-text: #1f2937;
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #ece9e6, #ffffff);
            color: var(--dark-text);
        }

        /* --- استایل کارت اصلی --- */
        .container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
        }

        .card {
            background-color: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: var(--card-shadow);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--dark-text);
        }

        p {
            color: var(--neutral-color);
            line-height: 1.6;
        }
        
        .info-box {
            background-color: var(--light-bg);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: right;
            border: 1px solid #e5e7eb;
        }

        .info-box p {
            margin: 5px 0;
            font-size: 0.9rem;
            word-wrap: break-word; /* برای شکستن شناسه‌های طولانی */
        }

        .info-box strong {
            color: var(--primary-color);
        }

        /* --- استایل دکمه --- */
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: 700;
            font-family: 'Vazirmatn', sans-serif;
            border-radius: 50px; /* دکمه کپسولی */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 20px;
        }

        .btn:hover {
            background-color: #d62255;
            transform: scale(1.05);
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn:disabled {
            background-color: #f9a7bf;
            cursor: not-allowed;
        }

        /* --- استایل بخش وضعیت --- */
        #status-container {
            margin-top: 30px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 700;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        #status-container.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .status-success {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid var(--success-color);
        }

        .status-error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid var(--error-color);
        }
        
        .status-connecting {
            background-color: #e0e7ff;
            color: #3730a3;
            border: 1px solid #6366f1;
        }

        #details {
            margin-top: 15px;
            font-family: monospace; /* فونت مناسب برای نمایش کد/خطا */
            text-align: left;
            direction: ltr;
            background-color: var(--light-bg);
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap; /* برای شکستن خطوط طولانی */
            word-break: break-all;
            font-size: 0.8rem;
            color: var(--neutral-color);
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="card">
            <h1>تست اتصال به Appwrite</h1>
            <p>این صفحه برای تست ارتباط با سرور Appwrite شما طراحی شده است. اطلاعات پروژه شما در زیر آمده است.</p>
            
            <div class="info-box">
                <p><strong>شناسه پروژه (Project ID):</strong> <code id="project-id"></code></p>
                <p><strong>آدرس سرور (API Endpoint):</strong> <code id="api-endpoint"></code></p>
            </div>

            <button id="test-btn" class="btn">شروع تست اتصال</button>

            <div id="status-container">
                <p id="status-message"></p>
                <pre id="details"></pre>
            </div>
        </div>
    </div>

    <!-- ایمپورت کردن کتابخانه Appwrite Web SDK -->
    <script type="module">
        // ایمپورت کردن کلاس‌های مورد نیاز از Appwrite SDK
        import { Client, Account, AppwriteException } from 'https://cdn.jsdelivr.net/npm/appwrite@13.0.0/dist/browser/appwrite.min.js';

        // --- تعریف ثابت‌ها و اطلاعات پروژه شما ---
        const PROJECT_ID = '68d024f50002176ce603';
        const API_ENDPOINT = 'https://fra.cloud.appwrite.io/v1';

        // --- دسترسی به عناصر HTML ---
        const testButton = document.getElementById('test-btn');
        const statusContainer = document.getElementById('status-container');
        const statusMessage = document.getElementById('status-message');
        const detailsContainer = document.getElementById('details');
        
        // نمایش اطلاعات پروژه در صفحه
        document.getElementById('project-id').textContent = PROJECT_ID;
        document.getElementById('api-endpoint').textContent = API_ENDPOINT;

        // --- مقداردهی اولیه Appwrite Client ---
        const client = new Client();
        client
            .setEndpoint(API_ENDPOINT)
            .setProject(PROJECT_ID);

        const account = new Account(client);

        // --- تابع اصلی برای تست اتصال ---
        async function testConnection() {
            // 1. آماده‌سازی UI برای تست
            testButton.disabled = true;
            testButton.textContent = 'در حال تست...';
            statusContainer.className = 'status-connecting visible';
            statusMessage.textContent = 'در حال برقراری ارتباط با سرور...';
            detailsContainer.textContent = '';

            try {
                // 2. تلاش برای اجرای یک درخواست ساده به سرور
                // ما از `account.get()` استفاده می‌کنیم. انتظار داریم این درخواست با خطای 401 (عدم دسترسی) مواجه شود،
                // چون کاربر لاگین نکرده است. دریافت این خطا یعنی ارتباط با سرور "موفق" بوده است.
                await account.get();
                
                // این بخش معمولا اجرا نمی‌شود مگر اینکه یک session فعال وجود داشته باشد
                updateUI('success', 'اتصال موفق بود و یک Session فعال پیدا شد!', 'شما از قبل وارد حساب کاربری خود شده‌اید.');

            } catch (error) {
                // 3. مدیریت خطاها
                if (error instanceof AppwriteException) {
                    // اگر خطا از نوع خطاهای شناخته‌شده Appwrite باشد
                    if (error.code === 401) {
                        // این بهترین نتیجه است! یعنی سرور در دسترس است ولی ما لاگین نیستیم.
                        updateUI(
                            'success', 
                            '✅ اتصال به سرور با موفقیت برقرار شد!', 
                            'سرور Appwrite به درستی پاسخ داد (خطای 401 به معنی نیاز به ورود کاربر است که کاملاً طبیعی است).\n\nپیکربندی شما صحیح است!'
                        );
                    } else {
                        // خطای دیگری از سمت سرور Appwrite
                        updateUI(
                            'error',
                            '❌ اتصال ناموفق بود! سرور Appwrite یک خطا برگرداند.',
                            `Code: ${error.code}\nMessage: ${error.message}\nType: ${error.type}`
                        );
                    }
                } else {
                    // اگر خطا از نوع شبکه، CORS یا مشکلات دیگر باشد
                    updateUI(
                        'error',
                        '❌ اتصال ناموفق بود! یک خطای اساسی رخ داد.',
                        `این خطا معمولاً به دلیل مشکلات شبکه یا تنظیمات CORS است.\n\nپیام خطا:\n${error.message}\n\nراه حل:\nمطمئن شوید هاست‌نیم abolfazl140122.github.io را در بخش Platforms کنسول پروژه Appwrite خود اضافه کرده‌اید.`
                    );
                }
            } finally {
                // 4. بازگرداندن UI به حالت اولیه
                testButton.disabled = false;
                testButton.textContent = 'تست مجدد اتصال';
            }
        }
        
        // --- تابع کمکی برای آپدیت کردن UI ---
        function updateUI(type, message, details) {
            statusMessage.textContent = message;
            detailsContainer.textContent = details;
            
            if (type === 'success') {
                statusContainer.className = 'status-success visible';
            } else if (type === 'error') {
                statusContainer.className = 'status-error visible';
            }
        }

        // --- افزودن رویداد کلیک به دکمه ---
        testButton.addEventListener('click', testConnection);

    </script>
</body>
</html>

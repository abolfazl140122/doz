<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ثبت‌نام کاربر در Appwrite</title>

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap");
    :root{
      --pink:#f02e65;--success:#10b981;--error:#ef4444;--gray:#6b7280;--light:#f9fafb
    }
    *{box-sizing:border-box}body{
      margin:0;display:flex;justify-content:center;align-items:center;
      min-height:100vh;background:#f2f5f7;font-family:"Vazirmatn",sans-serif
    }
    .box{background:#fff;padding:40px;border-radius:14px;box-shadow:0 8px 20px rgba(0,0,0,.1);width:100%;max-width:380px}
    h1{margin:0 0 20px;font-size:1.4rem;text-align:center}
    input{width:100%;padding:12px 14px;margin:8px 0;border:1px solid #d1d5db;border-radius:8px;font-family:inherit}
    button{width:100%;padding:12px;margin-top:12px;border:none;border-radius:8px;background:var(--pink);color:#fff;font-weight:700;cursor:pointer}
    button:hover{background:#d62255}
    #msg{margin-top:18px;font-weight:700;border-radius:8px;padding:12px;display:none}
    .ok{background:#d1fae5;color:#065f46}
    .err{background:#fee2e2;color:#991b1b}
  </style>
</head>
<body>

  <div class="box">
    <h1>فرم ثبت‌نام</h1>

    <input id="name"  type="text"     placeholder="نام (اختیاری)" />
    <input id="email" type="email"    placeholder="ایمیل" />
    <input id="pass"  type="password" placeholder="رمز عبور" />

    <button id="signup">ثبت نام</button>

    <div id="msg"></div>
  </div>

  <script type="module">
    import { Client, Account, ID, AppwriteException } from
      "https://cdn.jsdelivr.net/npm/appwrite@13/dist/browser/appwrite.min.js";

    /* ------ تنظیمات پروژه ------ */
    const PROJECT  = "68d024f50002176ce603";
    const ENDPOINT = "https://fra.cloud.appwrite.io";

    const client  = new Client().setEndpoint(ENDPOINT).setProject(PROJECT);
    const account = new Account(client);

    /* ------ عناصر صفحه ------ */
    const $ = (id)=>document.getElementById(id);
    const msgBox = $("msg");

    function show(type,text){
      msgBox.className = type==="ok" ? "ok" : "err";
      msgBox.textContent = text;
      msgBox.style.display = "block";
    }

    $("signup").addEventListener("click", async ()=>{
      const email = $("email").value.trim();
      const pass  = $("pass").value;
      const name  = $("name").value.trim();

      if(!email || !pass){
        show("err","ایمیل و رمز عبور الزامی است!");
        return;
      }

      $("signup").disabled = true;
      show("","در حال ثبت…");

      try{
        /* -------- ساخت کاربر -------- */
        await account.create(ID.unique(), email, pass, name || undefined);

        /* -------- ورود (session) -------- */
        await account.createEmailSession(email, pass);

        show("ok","✅ کاربر ایجاد و لاگین شد! اکنون در کنسول Appwrite → Auth می‌بینید.");
      }
      catch(e){
        if(e instanceof AppwriteException){
          show("err",`❌ ${e.message} (کد ${e.code})`);
        }else{
          show("err","❌ خطای ارتباطی: "+e.message);
        }
      }
      finally{
        $("signup").disabled = false;
      }
    });
  </script>
</body>
</html>

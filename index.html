<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تست اتصال به سرور Appwrite</title>
    
    <!-- Import Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* CSS Styles */
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            color: #333;
        }

        .container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 90%;
            max-width: 500px;
            border-top: 5px solid #6c757d; /* Default border color */
            transition: border-color 0.5s ease;
        }

        h1 {
            color: #1d2d50;
            margin-bottom: 30px;
        }

        .status-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100px;
        }

        /* Loader Animation */
        .loader {
            border: 6px solid #e0e0e0; /* Light grey */
            border-top: 6px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1.5s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #status-message {
            font-size: 1.1rem;
            font-weight: bold;
            color: #555;
            transition: color 0.5s ease;
        }
        
        /* Success State */
        .status-success {
            border-top-color: #28a745; /* Green */
        }
        .status-success #status-message {
            color: #28a745;
        }

        /* Error State */
        .status-error {
            border-top-color: #dc3545; /* Red */
        }
        .status-error #status-message {
            color: #dc3545;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <div class="container" id="main-container">
        <h1>تست اتصال به سرور Appwrite</h1>
        <div class="status-container">
            <div class="loader" id="loader"></div>
            <p id="status-message">در حال تلاش برای اتصال به سرور...</p>
        </div>
    </div>

    <!-- Appwrite Web SDK -->
    <script src="https://cdn.jsdelivr.net/npm/appwrite@14.0.1/dist/browser/appwrite.min.js"></script>

    <script>
        // JavaScript Logic
        document.addEventListener('DOMContentLoaded', () => {
            // اطلاعات سرور شما
            const APPWRITE_ENDPOINT = 'https://fra.cloud.appwrite.io/v1';
            const APPWRITE_PROJECT_ID = '68d024f50002176ce603';

            // انتخاب عناصر HTML
            const mainContainer = document.getElementById('main-container');
            const loader = document.getElementById('loader');
            const statusMessage = document.getElementById('status-message');

            // مقداردهی اولیه Appwrite SDK
            const { Client, Account } = Appwrite;
            const client = new Client();

            client
                .setEndpoint(APPWRITE_ENDPOINT)
                .setProject(APPWRITE_PROJECT_ID);

            const account = new Account(client);

            // تابع تست اتصال
            async function testConnection() {
                try {
                    // ما تلاش میکنیم اطلاعات حساب کاربری را بگیریم.
                    // چون لاگین نیستیم، این دستور باید یک خطا برگرداند.
                    // اگر خطای 401 (عدم دسترسی) دریافت کنیم، یعنی اتصال موفق بوده است.
                    await account.get();
                    
                    // این بخش به ندرت اجرا می‌شود (مگر اینکه یک سشن فعال از قبل وجود داشته باشد)
                    setSuccessState("اتصال موفقیت‌آمیز بود. (یک جلسه فعال در مرورگر شما وجود دارد)");

                } catch (error) {
                    // بررسی می‌کنیم که آیا خطا از سمت سرور Appwrite است یا یک خطای شبکه
                    if (error.code && error.code >= 400) {
                        // این حالت موفقیت‌آمیز است! سرور به درخواست ما پاسخ داده است.
                        // خطای 401 طبیعی است چون ما لاگین نکرده‌ایم.
                        setSuccessState(`اتصال موفقیت‌آمیز بود. سرور Appwrite به درستی پاسخ داد. (پیام سرور: ${error.message})`);
                    } else {
                        // این یک خطای شبکه است (مانند CORS، DNS یا قطع بودن اینترنت)
                        // نکته: اگر با خطای CORS مواجه شدید، باید دامنه خود را در پنل Appwrite در بخش Platforms اضافه کنید.
                        // اگر این فایل را به صورت محلی باز میکنید، 'localhost' را اضافه کنید.
                        setFailureState(`اتصال با خطا مواجه شد. لطفاً تنظیمات شبکه و CORS در پنل Appwrite را بررسی کنید. (پیام خطا: ${error.message})`);
                    }
                }
            }

            function setSuccessState(message) {
                loader.classList.add('hidden');
                statusMessage.textContent = message;
                mainContainer.classList.add('status-success');
            }

            function setFailureState(message) {
                loader.classList.add('hidden');
                statusMessage.textContent = message;
                mainContainer.classList.add('status-error');
            }

            // اجرای تست پس از 1 ثانیه برای نمایش بهتر انیمیشن لودینگ
            setTimeout(testConnection, 1000);
        });
    </script>

</body>
</html>
